
  0%|                                                                                                                                                                                | 0/30000 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)



 33%|██████████████████████████████████████████████████████▎                                                                                                            | 10005/30000 [00:29<01:24, 236.34it/s]




 33%|██████████████████████████████████████████████████████▋                                                                                                             | 10010/30000 [00:59<03:57, 84.19it/s]





 33%|██████████████████████████████████████████████████████▋                                                                                                             | 10015/30000 [01:28<15:03, 22.13it/s]



 33%|██████████████████████████████████████████████████████▊                                                                                                             | 10020/30000 [01:58<37:45,  8.82it/s]



 33%|██████████████████████████████████████████████████████▏                                                                                                           | 10025/30000 [02:28<1:21:56,  4.06it/s]



 33%|██████████████████████████████████████████████████████▏                                                                                                           | 10030/30000 [02:56<2:42:58,  2.04it/s]





 33%|██████████████████████████████████████████████████████▏                                                                                                           | 10035/30000 [03:26<4:55:55,  1.12it/s]




 33%|██████████████████████████████████████████████████████▏                                                                                                           | 10040/30000 [03:54<8:38:38,  1.56s/it]




 33%|█████████████████████████████████████████████████████▉                                                                                                           | 10045/30000 [04:23<18:35:32,  3.35s/it]




 34%|█████████████████████████████████████████████████████▉                                                                                                           | 10050/30000 [04:54<27:02:10,  4.88s/it]





 34%|█████████████████████████████████████████████████████▉                                                                                                           | 10055/30000 [05:23<31:00:46,  5.60s/it]





 34%|█████████████████████████████████████████████████████▉                                                                                                           | 10060/30000 [05:53<32:21:24,  5.84s/it]





 34%|██████████████████████████████████████████████████████                                                                                                           | 10065/30000 [06:23<32:29:23,  5.87s/it]





 34%|██████████████████████████████████████████████████████                                                                                                           | 10070/30000 [06:53<33:03:12,  5.97s/it]





 34%|██████████████████████████████████████████████████████                                                                                                           | 10075/30000 [07:23<32:50:05,  5.93s/it]




 34%|██████████████████████████████████████████████████████                                                                                                           | 10079/30000 [07:46<32:40:14,  5.90s/it]





 34%|██████████████████████████████████████████████████████                                                                                                           | 10084/30000 [08:16<32:55:00,  5.95s/it]





 34%|██████████████████████████████████████████████████████▏                                                                                                          | 10089/30000 [08:46<32:18:49,  5.84s/it]





 34%|██████████████████████████████████████████████████████▏                                                                                                          | 10094/30000 [09:18<34:37:35,  6.26s/it]





 34%|██████████████████████████████████████████████████████▏                                                                                                          | 10099/30000 [09:47<33:29:19,  6.06s/it]





 34%|██████████████████████████████████████████████████████▏                                                                                                          | 10104/30000 [10:16<32:36:26,  5.90s/it]





 34%|██████████████████████████████████████████████████████▎                                                                                                          | 10109/30000 [10:47<33:09:54,  6.00s/it]





 34%|██████████████████████████████████████████████████████▎                                                                                                          | 10114/30000 [11:18<35:02:44,  6.34s/it]





 34%|██████████████████████████████████████████████████████▎                                                                                                          | 10119/30000 [11:48<33:53:07,  6.14s/it]





 34%|██████████████████████████████████████████████████████▎                                                                                                          | 10124/30000 [12:18<33:03:48,  5.99s/it]





 34%|██████████████████████████████████████████████████████▎                                                                                                          | 10129/30000 [12:47<32:53:36,  5.96s/it]





 34%|██████████████████████████████████████████████████████▍                                                                                                          | 10134/30000 [13:16<32:11:32,  5.83s/it]





 34%|██████████████████████████████████████████████████████▍                                                                                                          | 10139/30000 [13:46<32:41:51,  5.93s/it]





 34%|██████████████████████████████████████████████████████▍                                                                                                          | 10144/30000 [14:16<33:27:58,  6.07s/it]





 34%|██████████████████████████████████████████████████████▍                                                                                                          | 10149/30000 [14:45<32:45:38,  5.94s/it]





 34%|██████████████████████████████████████████████████████▍                                                                                                          | 10154/30000 [15:14<31:52:12,  5.78s/it]





 34%|██████████████████████████████████████████████████████▌                                                                                                          | 10159/30000 [15:43<31:42:48,  5.75s/it]





 34%|██████████████████████████████████████████████████████▌                                                                                                          | 10164/30000 [16:12<31:59:02,  5.80s/it]





 34%|██████████████████████████████████████████████████████▌                                                                                                          | 10169/30000 [16:43<33:34:12,  6.09s/it]





 34%|██████████████████████████████████████████████████████▌                                                                                                          | 10174/30000 [17:12<32:36:16,  5.92s/it]





 34%|██████████████████████████████████████████████████████▋                                                                                                          | 10179/30000 [17:42<32:34:16,  5.92s/it]






 34%|██████████████████████████████████████████████████████▋                                                                                                          | 10185/30000 [18:18<32:17:02,  5.87s/it]





 34%|██████████████████████████████████████████████████████▋                                                                                                          | 10190/30000 [18:48<32:14:02,  5.86s/it]




 34%|██████████████████████████████████████████████████████▋                                                                                                          | 10194/30000 [19:11<32:38:47,  5.93s/it]





 34%|██████████████████████████████████████████████████████▋                                                                                                          | 10199/30000 [19:41<32:30:22,  5.91s/it]





 34%|██████████████████████████████████████████████████████▊                                                                                                          | 10204/30000 [20:09<31:55:22,  5.81s/it]





 34%|██████████████████████████████████████████████████████▊                                                                                                          | 10209/30000 [20:39<32:10:20,  5.85s/it]






 34%|██████████████████████████████████████████████████████▊                                                                                                          | 10215/30000 [21:14<32:47:11,  5.97s/it]




 34%|██████████████████████████████████████████████████████▊                                                                                                          | 10219/30000 [21:39<34:00:32,  6.19s/it]





 34%|██████████████████████████████████████████████████████▊                                                                                                          | 10224/30000 [22:09<33:35:23,  6.11s/it]





 34%|██████████████████████████████████████████████████████▉                                                                                                          | 10229/30000 [22:39<32:47:15,  5.97s/it]





 34%|██████████████████████████████████████████████████████▉                                                                                                          | 10234/30000 [23:09<31:53:44,  5.81s/it]





 34%|██████████████████████████████████████████████████████▉                                                                                                          | 10239/30000 [23:37<31:47:58,  5.79s/it]





 34%|██████████████████████████████████████████████████████▉                                                                                                          | 10244/30000 [24:07<32:54:42,  6.00s/it]






 34%|███████████████████████████████████████████████████████                                                                                                          | 10250/30000 [24:42<30:57:08,  5.64s/it]





 34%|███████████████████████████████████████████████████████                                                                                                          | 10255/30000 [25:12<32:24:25,  5.91s/it]





 34%|███████████████████████████████████████████████████████                                                                                                          | 10260/30000 [25:42<32:38:36,  5.95s/it]




 34%|███████████████████████████████████████████████████████                                                                                                          | 10264/30000 [26:06<32:38:31,  5.95s/it]






 34%|███████████████████████████████████████████████████████                                                                                                          | 10270/30000 [26:41<32:22:03,  5.91s/it]





 34%|███████████████████████████████████████████████████████▏                                                                                                         | 10275/30000 [27:11<33:01:14,  6.03s/it]





 34%|███████████████████████████████████████████████████████▏                                                                                                         | 10280/30000 [27:40<32:23:29,  5.91s/it]





 34%|███████████████████████████████████████████████████████▏                                                                                                         | 10285/30000 [28:11<33:04:11,  6.04s/it]





 34%|███████████████████████████████████████████████████████▏                                                                                                         | 10290/30000 [28:40<33:06:07,  6.05s/it]




 34%|███████████████████████████████████████████████████████▏                                                                                                         | 10294/30000 [29:04<32:13:47,  5.89s/it]





 34%|███████████████████████████████████████████████████████▎                                                                                                         | 10299/30000 [29:34<32:49:37,  6.00s/it]






 34%|███████████████████████████████████████████████████████▎                                                                                                         | 10305/30000 [30:10<33:05:36,  6.05s/it]





 34%|███████████████████████████████████████████████████████▎                                                                                                         | 10310/30000 [30:40<32:39:48,  5.97s/it]





 34%|███████████████████████████████████████████████████████▎                                                                                                         | 10315/30000 [31:10<32:38:57,  5.97s/it]




 34%|███████████████████████████████████████████████████████▍                                                                                                         | 10319/30000 [31:34<32:22:35,  5.92s/it]





 34%|███████████████████████████████████████████████████████▍                                                                                                         | 10324/30000 [32:03<32:06:24,  5.87s/it]






 34%|███████████████████████████████████████████████████████▍                                                                                                         | 10330/30000 [32:39<32:47:18,  6.00s/it]




 34%|███████████████████████████████████████████████████████▍                                                                                                         | 10334/30000 [33:03<32:40:48,  5.98s/it]





 34%|███████████████████████████████████████████████████████▍                                                                                                         | 10339/30000 [33:32<32:27:35,  5.94s/it]





 34%|███████████████████████████████████████████████████████▌                                                                                                         | 10344/30000 [34:02<32:02:49,  5.87s/it]





 34%|███████████████████████████████████████████████████████▌                                                                                                         | 10349/30000 [34:33<33:05:17,  6.06s/it]





 35%|███████████████████████████████████████████████████████▌                                                                                                         | 10354/30000 [35:02<32:13:08,  5.90s/it]





 35%|███████████████████████████████████████████████████████▌                                                                                                         | 10359/30000 [35:31<31:25:35,  5.76s/it]





 35%|███████████████████████████████████████████████████████▌                                                                                                         | 10364/30000 [36:01<31:33:45,  5.79s/it]





 35%|███████████████████████████████████████████████████████▋                                                                                                         | 10369/30000 [36:31<32:34:52,  5.97s/it]





 35%|███████████████████████████████████████████████████████▋                                                                                                         | 10374/30000 [37:00<32:08:33,  5.90s/it]






 35%|███████████████████████████████████████████████████████▋                                                                                                         | 10380/30000 [37:39<34:20:51,  6.30s/it]




 35%|███████████████████████████████████████████████████████▋                                                                                                         | 10384/30000 [38:03<32:18:14,  5.93s/it]





 35%|███████████████████████████████████████████████████████▊                                                                                                         | 10389/30000 [38:33<32:37:55,  5.99s/it]





 35%|███████████████████████████████████████████████████████▊                                                                                                         | 10394/30000 [39:03<32:40:20,  6.00s/it]





 35%|███████████████████████████████████████████████████████▊                                                                                                         | 10399/30000 [39:31<29:24:45,  5.40s/it]





 35%|███████████████████████████████████████████████████████▊                                                                                                         | 10404/30000 [40:01<32:26:16,  5.96s/it]





 35%|███████████████████████████████████████████████████████▊                                                                                                         | 10409/30000 [40:30<32:37:46,  6.00s/it]






 35%|███████████████████████████████████████████████████████▉                                                                                                         | 10415/30000 [41:06<32:22:24,  5.95s/it]




 35%|███████████████████████████████████████████████████████▉                                                                                                         | 10419/30000 [41:30<32:43:32,  6.02s/it]





 35%|███████████████████████████████████████████████████████▉                                                                                                         | 10424/30000 [42:01<33:02:22,  6.08s/it]





 35%|███████████████████████████████████████████████████████▉                                                                                                         | 10429/30000 [42:30<32:09:06,  5.91s/it]





 35%|███████████████████████████████████████████████████████▉                                                                                                         | 10434/30000 [42:59<31:44:41,  5.84s/it]





 35%|████████████████████████████████████████████████████████                                                                                                         | 10439/30000 [43:30<33:08:26,  6.10s/it]





 35%|████████████████████████████████████████████████████████                                                                                                         | 10444/30000 [43:59<31:05:08,  5.72s/it]





 35%|████████████████████████████████████████████████████████                                                                                                         | 10449/30000 [44:29<33:03:32,  6.09s/it]





 35%|████████████████████████████████████████████████████████                                                                                                         | 10454/30000 [45:00<33:11:59,  6.11s/it]






 35%|████████████████████████████████████████████████████████▏                                                                                                        | 10460/30000 [45:36<32:46:16,  6.04s/it]




 35%|████████████████████████████████████████████████████████▏                                                                                                        | 10464/30000 [46:00<32:14:03,  5.94s/it]





 35%|████████████████████████████████████████████████████████▏                                                                                                        | 10469/30000 [46:31<33:00:14,  6.08s/it]





 35%|████████████████████████████████████████████████████████▏                                                                                                        | 10474/30000 [47:00<32:42:15,  6.03s/it]






 35%|████████████████████████████████████████████████████████▏                                                                                                        | 10480/30000 [47:36<32:25:23,  5.98s/it]




 35%|████████████████████████████████████████████████████████▎                                                                                                        | 10484/30000 [48:01<33:10:27,  6.12s/it]





 35%|████████████████████████████████████████████████████████▎                                                                                                        | 10489/30000 [48:31<32:20:08,  5.97s/it]





 35%|████████████████████████████████████████████████████████▎                                                                                                        | 10494/30000 [49:01<32:44:55,  6.04s/it]





 35%|████████████████████████████████████████████████████████▎                                                                                                        | 10499/30000 [49:31<32:29:48,  6.00s/it]






 35%|████████████████████████████████████████████████████████▍                                                                                                        | 10505/30000 [50:06<32:13:54,  5.95s/it]





 35%|████████████████████████████████████████████████████████▍                                                                                                        | 10510/30000 [50:36<32:44:37,  6.05s/it]




 35%|████████████████████████████████████████████████████████▍                                                                                                        | 10514/30000 [50:59<31:02:29,  5.73s/it]






 35%|████████████████████████████████████████████████████████▍                                                                                                        | 10520/30000 [51:35<32:15:28,  5.96s/it]




 35%|████████████████████████████████████████████████████████▍                                                                                                        | 10524/30000 [51:58<31:19:08,  5.79s/it]





 35%|████████████████████████████████████████████████████████▌                                                                                                        | 10529/30000 [52:26<30:28:31,  5.63s/it]





 35%|████████████████████████████████████████████████████████▌                                                                                                        | 10534/30000 [52:55<32:08:53,  5.95s/it]






 35%|████████████████████████████████████████████████████████▌                                                                                                        | 10540/30000 [53:32<32:52:44,  6.08s/it]




 35%|████████████████████████████████████████████████████████▌                                                                                                        | 10544/30000 [53:56<32:03:00,  5.93s/it]





 35%|████████████████████████████████████████████████████████▌                                                                                                        | 10549/30000 [54:24<31:07:28,  5.76s/it]





 35%|████████████████████████████████████████████████████████▋                                                                                                        | 10554/30000 [54:53<30:56:19,  5.73s/it]





 35%|████████████████████████████████████████████████████████▋                                                                                                        | 10559/30000 [55:24<32:14:39,  5.97s/it]





 35%|████████████████████████████████████████████████████████▋                                                                                                        | 10564/30000 [55:53<31:48:16,  5.89s/it]





 35%|████████████████████████████████████████████████████████▋                                                                                                        | 10569/30000 [56:24<32:40:45,  6.05s/it]





 35%|████████████████████████████████████████████████████████▋                                                                                                        | 10574/30000 [56:53<31:42:55,  5.88s/it]






 35%|████████████████████████████████████████████████████████▊                                                                                                        | 10580/30000 [57:29<31:51:08,  5.90s/it]





 35%|████████████████████████████████████████████████████████▊                                                                                                        | 10585/30000 [57:59<32:46:04,  6.08s/it]




 35%|████████████████████████████████████████████████████████▊                                                                                                        | 10589/30000 [58:22<31:31:40,  5.85s/it]






 35%|████████████████████████████████████████████████████████▊                                                                                                        | 10595/30000 [58:57<31:30:02,  5.84s/it]




 35%|████████████████████████████████████████████████████████▉                                                                                                        | 10599/30000 [59:20<31:49:53,  5.91s/it]





 35%|████████████████████████████████████████████████████████▉                                                                                                        | 10604/30000 [59:49<31:42:45,  5.89s/it]





 35%|████████████████████████████████████████████████████████▏                                                                                                      | 10609/30000 [1:00:19<31:16:20,  5.81s/it]





 35%|████████████████████████████████████████████████████████▎                                                                                                      | 10614/30000 [1:00:49<32:16:57,  5.99s/it]





 35%|████████████████████████████████████████████████████████▎                                                                                                      | 10619/30000 [1:01:18<31:53:31,  5.92s/it]





 35%|████████████████████████████████████████████████████████▎                                                                                                      | 10624/30000 [1:01:47<30:45:26,  5.71s/it]






 35%|████████████████████████████████████████████████████████▎                                                                                                      | 10630/30000 [1:02:23<31:38:54,  5.88s/it]




 35%|████████████████████████████████████████████████████████▎                                                                                                      | 10634/30000 [1:02:47<31:51:39,  5.92s/it]





 35%|████████████████████████████████████████████████████████▍                                                                                                      | 10639/30000 [1:03:17<32:16:11,  6.00s/it]





 35%|████████████████████████████████████████████████████████▍                                                                                                      | 10644/30000 [1:03:45<31:20:44,  5.83s/it]





 35%|████████████████████████████████████████████████████████▍                                                                                                      | 10649/30000 [1:04:14<31:17:37,  5.82s/it]





 36%|████████████████████████████████████████████████████████▍                                                                                                      | 10654/30000 [1:04:44<32:15:21,  6.00s/it]





 36%|████████████████████████████████████████████████████████▍                                                                                                      | 10659/30000 [1:05:14<31:54:38,  5.94s/it]





 36%|████████████████████████████████████████████████████████▌                                                                                                      | 10664/30000 [1:05:44<32:00:37,  5.96s/it]

 36%|████████████████████████████████████████████████████████▌                                                                                                      | 10665/30000 [1:05:50<32:49:12,  6.11s/it]Traceback (most recent call last):
  File "/home/jingbo/KVMemory/finetune_combine.py", line 91, in <module>
    main()
  File "/home/jingbo/KVMemory/finetune_combine.py", line 85, in main
    trainer.train(resume_from_checkpoint = True)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 1938, in train
    return inner_training_loop(
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 2279, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 3349, in training_step
    self.accelerator.backward(loss, **kwargs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/accelerate/accelerator.py", line 2143, in backward
    self.deepspeed_engine_wrapped.backward(loss, **kwargs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/accelerate/utils/deepspeed.py", line 166, in backward
    self.engine.backward(loss, **kwargs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
    ret_val = func(*args, **kwargs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1967, in backward
    self.optimizer.backward(loss, retain_graph=retain_graph)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 2057, in backward
    self.loss_scaler.backward(loss.float(), retain_graph=retain_graph)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/deepspeed/runtime/fp16/loss_scaler.py", line 63, in backward
    scaled_loss.backward(retain_graph=retain_graph)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/_tensor.py", line 525, in backward
    torch.autograd.backward(
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/autograd/__init__.py", line 267, in backward
    _engine_run_backward(
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/autograd/graph.py", line 744, in _engine_run_backward
    return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
KeyboardInterrupt
[rank0]: Traceback (most recent call last):
[rank0]:   File "/home/jingbo/KVMemory/finetune_combine.py", line 91, in <module>
[rank0]:     main()
[rank0]:   File "/home/jingbo/KVMemory/finetune_combine.py", line 85, in main
[rank0]:     trainer.train(resume_from_checkpoint = True)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 1938, in train
[rank0]:     return inner_training_loop(
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 2279, in _inner_training_loop
[rank0]:     tr_loss_step = self.training_step(model, inputs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 3349, in training_step
[rank0]:     self.accelerator.backward(loss, **kwargs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/accelerate/accelerator.py", line 2143, in backward
[rank0]:     self.deepspeed_engine_wrapped.backward(loss, **kwargs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/accelerate/utils/deepspeed.py", line 166, in backward
[rank0]:     self.engine.backward(loss, **kwargs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1967, in backward
[rank0]:     self.optimizer.backward(loss, retain_graph=retain_graph)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 2057, in backward
[rank0]:     self.loss_scaler.backward(loss.float(), retain_graph=retain_graph)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/deepspeed/runtime/fp16/loss_scaler.py", line 63, in backward
[rank0]:     scaled_loss.backward(retain_graph=retain_graph)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/_tensor.py", line 525, in backward
[rank0]:     torch.autograd.backward(
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/autograd/__init__.py", line 267, in backward
[rank0]:     _engine_run_backward(
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/autograd/graph.py", line 744, in _engine_run_backward
[rank0]:     return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
[rank0]: KeyboardInterrupt