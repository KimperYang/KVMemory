
  0%|                                                                                                                                                                                                    | 0/30000 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)




  0%|                                                                                                                                                                                         | 5/30000 [00:28<46:48:30,  5.62s/it]




  0%|                                                                                                                                                                                         | 9/30000 [00:51<47:50:16,  5.74s/it]





  0%|                                                                                                                                                                                        | 14/30000 [01:21<49:47:00,  5.98s/it]






  0%|                                                                                                                                                                                        | 20/30000 [01:56<47:56:01,  5.76s/it]





  0%|▏                                                                                                                                                                                       | 25/30000 [02:25<47:49:21,  5.74s/it]




  0%|▏                                                                                                                                                                                       | 29/30000 [02:48<48:03:34,  5.77s/it]






  0%|▏                                                                                                                                                                                       | 35/30000 [03:23<48:21:56,  5.81s/it]




  0%|▏                                                                                                                                                                                       | 39/30000 [03:46<47:46:01,  5.74s/it]





  0%|▎                                                                                                                                                                                       | 44/30000 [04:16<49:57:43,  6.00s/it]





  0%|▎                                                                                                                                                                                       | 49/30000 [04:46<49:40:55,  5.97s/it]





  0%|▎                                                                                                                                                                                       | 54/30000 [05:16<49:29:50,  5.95s/it]





  0%|▎                                                                                                                                                                                       | 59/30000 [05:45<48:49:57,  5.87s/it]





  0%|▍                                                                                                                                                                                       | 64/30000 [06:13<47:29:49,  5.71s/it]





  0%|▍                                                                                                                                                                                       | 69/30000 [06:44<49:55:47,  6.01s/it]





  0%|▍                                                                                                                                                                                       | 74/30000 [07:12<48:28:13,  5.83s/it]






  0%|▍                                                                                                                                                                                       | 80/30000 [07:47<47:37:59,  5.73s/it]




  0%|▌                                                                                                                                                                                       | 84/30000 [08:10<47:59:02,  5.77s/it]





  0%|▌                                                                                                                                                                                       | 89/30000 [08:40<48:58:10,  5.89s/it]





  0%|▌                                                                                                                                                                                       | 94/30000 [09:08<47:30:26,  5.72s/it]





  0%|▌                                                                                                                                                                                       | 99/30000 [09:37<48:20:06,  5.82s/it]






  0%|▋                                                                                                                                                                                      | 105/30000 [10:18<52:24:24,  6.31s/it]




  0%|▋                                                                                                                                                                                      | 109/30000 [10:41<51:07:34,  6.16s/it]





  0%|▋                                                                                                                                                                                      | 114/30000 [11:11<50:08:15,  6.04s/it]






  0%|▋                                                                                                                                                                                      | 120/30000 [11:45<48:29:07,  5.84s/it]




  0%|▊                                                                                                                                                                                      | 124/30000 [12:10<50:27:27,  6.08s/it]





  0%|▊                                                                                                                                                                                      | 129/30000 [12:41<50:38:49,  6.10s/it]





  0%|▊                                                                                                                                                                                      | 134/30000 [13:10<48:49:44,  5.89s/it]






  0%|▊                                                                                                                                                                                      | 140/30000 [13:45<49:40:14,  5.99s/it]





  0%|▉                                                                                                                                                                                      | 145/30000 [14:14<47:52:41,  5.77s/it]




  0%|▉                                                                                                                                                                                      | 149/30000 [14:37<48:24:25,  5.84s/it]





  1%|▉                                                                                                                                                                                      | 154/30000 [15:06<48:25:05,  5.84s/it]





  1%|▉                                                                                                                                                                                      | 159/30000 [15:35<48:23:56,  5.84s/it]





  1%|█                                                                                                                                                                                      | 164/30000 [16:04<48:39:58,  5.87s/it]






  1%|█                                                                                                                                                                                      | 170/30000 [16:39<48:42:49,  5.88s/it]




  1%|█                                                                                                                                                                                      | 174/30000 [17:03<49:15:27,  5.95s/it]

  1%|█                                                                                                                                                                                      | 175/30000 [17:08<48:14:22,  5.82s/it]Traceback (most recent call last):
  File "/home/jingbo/KVMemory/finetune_combine.py", line 96, in <module>
    main()
  File "/home/jingbo/KVMemory/finetune_combine.py", line 90, in main
    trainer.train()
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 1938, in train
    return inner_training_loop(
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 2279, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 3318, in training_step
    loss = self.compute_loss(model, inputs)
  File "/home/jingbo/KVMemory/src/training/trainer.py", line 332, in compute_loss
    outputs = self.model(input_ids=input_ids, attention_mask=attention_mask, labels = input_ids)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/peft/peft_model.py", line 1430, in forward
    return self.base_model(
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/peft/tuners/tuners_utils.py", line 179, in forward
    return self.model.forward(*args, **kwargs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 1139, in forward
    outputs = self.model(
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 912, in forward
    causal_mask = self._update_causal_mask(
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 994, in _update_causal_mask
    if attention_mask is not None and 0.0 in attention_mask:
  File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/_tensor.py", line 1116, in __contains__
    return (element == self).any().item()  # type: ignore[union-attr]
KeyboardInterrupt
[rank0]: Traceback (most recent call last):
[rank0]:   File "/home/jingbo/KVMemory/finetune_combine.py", line 96, in <module>
[rank0]:     main()
[rank0]:   File "/home/jingbo/KVMemory/finetune_combine.py", line 90, in main
[rank0]:     trainer.train()
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 1938, in train
[rank0]:     return inner_training_loop(
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 2279, in _inner_training_loop
[rank0]:     tr_loss_step = self.training_step(model, inputs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/trainer.py", line 3318, in training_step
[rank0]:     loss = self.compute_loss(model, inputs)
[rank0]:   File "/home/jingbo/KVMemory/src/training/trainer.py", line 332, in compute_loss
[rank0]:     outputs = self.model(input_ids=input_ids, attention_mask=attention_mask, labels = input_ids)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/peft/peft_model.py", line 1430, in forward
[rank0]:     return self.base_model(
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/peft/tuners/tuners_utils.py", line 179, in forward
[rank0]:     return self.model.forward(*args, **kwargs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 1139, in forward
[rank0]:     outputs = self.model(
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 912, in forward
[rank0]:     causal_mask = self._update_causal_mask(
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 994, in _update_causal_mask
[rank0]:     if attention_mask is not None and 0.0 in attention_mask:
[rank0]:   File "/home/jingbo/anaconda3/envs/unlearning/lib/python3.9/site-packages/torch/_tensor.py", line 1116, in __contains__
[rank0]:     return (element == self).any().item()  # type: ignore[union-attr]
[rank0]: KeyboardInterrupt